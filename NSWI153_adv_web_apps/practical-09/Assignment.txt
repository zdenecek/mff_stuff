Advanced
Web Applications
Docker
Get ready
You need to bring your own computer to the practical.
Make sure you have installed you can execute following command:
In addition, please run following command before attending the practical.
Docker
docker run hello-world
# Ubuntu image
docker pull ubuntu:noble
# Apache
docker pull httpd:2.4.57
# NodeJS
docker pull node:21.7.2-slim
# Nginx
docker pull nginx:1.25.4
Objectives
• Docker Concepts
Images / Containers / Volumes / Ports / Networks
• Docker CLI
run / exec / inspect / ...
• Dockerfile
Basic commands / Users / Volumes
Build / Run / Tag / Publish
Multistage build
Behind the scene
• Containers are created by running/starting Images. An image contains a definition of a container.
This includes mostly file system layers and some metadata.
We can employ pull to download an image.
• Docker client (CLI, Docker Desktop, ...) and Docker daemon.
• Image versions (architectures, tags), , and scratch image.
• Export file system:
• - a tool for exploring a docker image
docker run hello-world
repository GitHub
# Create a container from an image, does not run the container!
# We may need to add a random command at the end.
docker create --name="{containername}" image:tag
# Export file system from the container.
docker export {container identifier} -o dump.tar
dive
Interactive container
• Create a new container:
• Create a file inside the container.
• Execute into the container from another terminal.
• List running containers.
• Stop and recreate the container. Check for the file.
docker run -it ubuntu:noble bash
docker exec -it {container} bash
docker ps
docker kill {container}
Persistent storage
Sometimes we need persistent storage across containers. The solution is to save data outside of
the container.
What about mapping Windows directory to Docker? It is possible via WSL. However not all
functionality is available and there may be performance issues.
Compare Named Volumes / Bind Mounts
# :(
npm run dev
Image with PHP
Start with ubuntu:noble and create custom image named server-php:latest with PHP and Apache.
Do not try this!
.
Now we can pause the image and create a container.
This probably takes a while ...
How to install and configure PHP
# Update package index.
apt-get update
# Install packages.
apt install php php-cli
# ...
# Pause the image.
docker pause {container}
# Create a container.
docker commit {container} server-php:latest
Custom HTTP server
•
• Create a directory with a simple HTML file.
• Start a container with a volume mapped to this directory.
• Visit .
• Modify the site.html file and refresh the page.
• Stop the container, this time we combine two commands together. Is shell specific (PowerShell).
Apache HTTP Serve
<!doctype html><title>Title</title><p>Content</p>
# PowerShell
docker run -it --rm -d -p 8080:80 -v "${PWD}:/usr/local/apache2/htdocs/" httpd:2.4.57
# Bash
docker run -it --rm -d -p 8080:80 -v ${PWD}:/usr/local/apache2/htdocs/ httpd:2.4.57
http://localhost:8080/site.html
docker kill $(docker ps -q)
Dockerfile
A better way to create and share definition of a Docker image. The are a number of commands
, as well as .
We need only a few basic commands:
• - Initialize new build stage and set base image for it.
• - Array (exec) and string (shell) form. Execute given command in a new layer
and commit the result. We can run with mount / network / security.
• - Copy files to a new layer
and commit the result. Create missing <dest> directories. To copy from remote see .
• ...
documentation best-practices
FROM <image> [AS <name>]
RUN <command>
COPY [--chown=<user>:<group>] [--chmod=<perms>] <src>... <dest>
ADD
Dockerfile
More commands ...
• - Can be used with UID and GID or names. Set active user for RUN,
ENTRYPOINT, and CMD.
• - Set environment property that does persist to the final image.
• - Create/set environment property that does NOT persist to the
final image.
• - Set current working directory. Crete any missing directories.
• - Container is listening on a given port.
USER <user>[:<group>]
ENV <key>=<value>
ARG <name>[=<default value>]
WORKDIR /path/to/working
EXPOSE <port>
Assignment: Vite
./practical-09/
There is a web application which can be used as a simple client for your 04-php-orm server
application. Your task is to add a "production-grade" Docker deployment. Use nginx:1.25.4
container to host the application.
Follow the steps to get to the reasonable Dockerfile.
Beware of potential pitfalls!
You are allowed to modify the application, but try to keep the changes minimal.
You need to be able build and run the Dockerfile using following commands in the "./practical-09/"
directory.
docker build -t nswi153/frontend .
docker run -p 8080:80 nswi153/frontend
What is this ...
Start by downloading and unpacking a . Once you familiarize yourself with the
application, your task is to create a Dockerfile.
Test the application locally. You can use your solution from 04-php-orm or an .
Once you feel you know all there is about the application continue to the following slide.
web application
API mock at webik
Building the application
• Start with :21.7.2-slim.
Do not use node or node:latest!
• Select working directory, mind the Linux file system conventions.
• Set VITE_INSTANCE_NAME to "Docker" as a default value.
• Copy files and build the project.
Why is this bad?
• Do not ignore .dockerignore.
• How do we host the application?
node
COPY . .
RUN npm install
RUN npm build
.*
node_modules
dist
Multistage build
We do not need the build-related libraries and code. We only need the content of the this
directory.
FROM {image} as build
FROM {another-image}
COPY --from=build {source} {target}
Hosting the application
• Create new stage using :1.25.4.
• Copy the distribution directory to /usr/share/nginx/html.
• Add metadata. This does not expose the port automatically!
nginx
EXPOSE 80
API proxy
The backend API is not part of our image, we need to proxy to other container / locations / ...
The Nginx configuration (container specific) is stored in /etc/nginx/conf.d/default.conf. We need to
change this file and add instruction for a proxy.
We want the backend to be set using ENV variable! This is Nginx specific.
server {
listen 80;
server_name localhost;
location / {
root /usr/share/nginx/html;
index index.html index.htm;
}
location /api/ {
proxy_pass https://webik.ms.mff.cuni.cz/nswi153/2024-2025/service/09/api/;
}
}
Configurable API Proxy
Files placed to /etc/nginx/templates/ are processed by 20-envsubst-on-templates.sh This script
substitutes environment variables in the Docker image at startup (runtime).
We need to set the ENV variable when running the container!
COPY ./nginx/default.conf.template /etc/nginx/templates/
# We need to use env variable as we need it to be available at runtime.
ENV SERVER_URL=http://server/api/
docker run -p 8080:80 -e SERVER_URL="https://webik.ms.mff.cuni.cz/~skoda/2023-24/api/" nswi153/
frontend
Extra content ...
Content beyond this slide is not a mandatory part of the seminar. Yet it may help you with better
use and understanding of Docker.
Docker run command
List of selected arguments:
• -it - with console
• --rm - remove container when finished
• --volume - map a volume / file system
• --port - map a port
There are single letter alternatives!
Additional Docker commands
• - Array (exec ~ no substitution!) and string (shell) form. Use for
"executable" containers. Rest CMD from the base image.
• - Array (exec or default parameters to ENTRYPOINT) and string (shell) form.
Provide defaults for container execution.
• ... - Defines healthcheck.
• - Array or string form. After the image is started, Docker create new mounting
point and initialize it with the content of the directory.
ENTRYPOINT <command>
CMD <command>
HEALTHCHECK
VOLUME ["/data"]
Questions, ideas, or any other feedback?
Please feel free to use the anonymous feedback form.